@using AuctionExpert.Web.ViewModels.Auction;
@model DetailViewModel

@{
    this.ViewData["Title"] = "Auction Details";
}

<div class="inner-banner">
    <div class="container">
        <h2 class="inner-banner-title  wow fadeInLeft" data-wow-duration="1.5s" data-wow-delay=".4s">Auction Details</h2>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Auction Details</li>
            </ol>
        </nav>
    </div>
</div>

<div class="auction-details-section pt-120">
    <img alt="image" src="~/assets/images/bg/section-bg.png" class="img-fluid section-bg-top">
    <img alt="image" src="~/assets/images/bg/section-bg.png" class="img-fluid section-bg-bottom">
    <div class="container">
        <div class="row g-4 mb-50">
            <div class="col-xl-6 col-lg-7 d-flex flex-row align-items-start justify-content-lg-start justify-content-center flex-md-nowrap flex-wrap gap-4">
                <ul class="nav small-image-list d-flex flex-md-column flex-row justify-content-center gap-4  wow fadeInDown" data-wow-duration="1.5s" data-wow-delay=".4s">
                    @for (int i = 0; i < Model.Images.Count(); i++)
                    {
                        var image = Model.Images.ToArray()[i];
                        <li class="nav-item">
                            <div data-bs-toggle="pill" id="image+@i" onclick="LoadBigImage(@i)">
                                <img alt="image" src="@image.UrlPath" class="img-fluid">
                            </div>
                        </li>
                    }
                </ul>
                <div class="tab-content mb-4 d-flex justify-content-lg-start justify-content-center  wow fadeInUp" data-wow-duration="1.5s" data-wow-delay=".4s">
                    <div class="tab-pane big-image fade show active">
                        <img alt="image" id="bigImage" src="@Model.Images.First().UrlPath" class="img-fluid">
                    </div>
                </div>
            </div>
            <div class="col-xl-6 col-lg-5">
                <div class="product-details-right  wow fadeInDown" data-wow-duration="1.5s" data-wow-delay=".2s">
                    <h3>@Model.Title</h3>
                    @*SHORT DESCRIPTION*@
                    @if (Model.Description.Length > 20)
                    {
                        <p class="para">@Model.Description.Substring(0, 20)...</p>
                    }
                    else
                    {
                        <p class="para">@Model.Description</p>
                    }
                    <h4>Bidding Price: <span>$@Model.BiddingPrice</span></h4>
                    <div class="bid-form">
                        <div class="form-title">
                            <h5>Bid Now</h5>
                            <p>Bid Amount : Minimum Bid $@(Model.BiddingPrice + Model.StepAmount)</p>
                        </div>
                        <form method="post" asp-controller="Auction" asp-action="Details" asp-route-Id="@Model.Id">
                            <div asp-validation-summary="All" class="text-danger"></div>
                            <div class="form-inner gap-2">
                                <input asp-for="CurrentBid" type="number" class="form-control" placeholder="Place your bid here..." />
                                <button class="eg-btn btn--primary btn--sm" type="submit">Place Bid</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="row d-flex justify-content-center g-4">
            <div class="col-lg-8">
                <ul class="nav nav-pills d-flex flex-row justify-content-start gap-sm-4 gap-3 mb-45 wow fadeInDown" data-wow-duration="1.5s" data-wow-delay=".2s" id="pills-tab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active details-tab-btn" id="pills-home-tab" data-bs-toggle="pill" data-bs-target="#pills-home" type="button" role="tab" aria-controls="pills-home" aria-selected="true">Description</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link details-tab-btn" id="pills-bid-tab" data-bs-toggle="pill" data-bs-target="#pills-bid" type="button" role="tab" aria-controls="pills-bid" aria-selected="false">Biding History</button>
                    </li>
                </ul>
                <div class="tab-content" id="pills-tabContent">
                    <div class="tab-pane fade show active wow fadeInUp" data-wow-duration="1.5s" data-wow-delay=".2s" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
                        <div class="describe-content">
                            <p class="para">@Model.Description</p>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="pills-bid" role="tabpanel" aria-labelledby="pills-bid-tab">
                        <div class="bid-list-area">
                            @if (!Model.Bidders.Any())
                            {
                                <h5 class="text-center">Place the first bid to start the war.</h5>
                            }
                            else
                            {
                                <ul class="bid-list">
                                    @foreach (var bidder in Model.Bidders.OrderByDescending(x => x.MoneyPlaced))
                                    {
                                        <li>
                                            <div class="row d-flex align-items-center">
                                                <div class="col-7">
                                                    <div class="bidder-area">
                                                        @if (bidder.ProfileImageUrl != null)
                                                        {
                                                            <div class="bidder-img">
                                                                <img alt="image" src="@bidder.ProfileImageUrl">
                                                            </div>
                                                        }
                                                        <div class="bidder-content">
                                                            <h6>@bidder.Username</h6>
                                                            <p>@bidder.MoneyPlaced lv.</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-5 text-end">
                                                    <div class="bid-time">
                                                        @if (bidder.TimePlaced.TotalMinutes < 60)
                                                        {
                                                            <p>@bidder.TimePlaced.Minutes Minutes Ago.</p>
                                                        }
                                                        else if (bidder.TimePlaced.TotalMinutes >= 60 && bidder.TimePlaced.TotalMinutes < 1440)
                                                        {
                                                            <p>@bidder.TimePlaced.Hours Hours Ago.</p>
                                                        }
                                                        else
                                                        {
                                                            <p>@bidder.TimePlaced.Days Days Ago.</p>
                                                        }
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                    }
                                </ul>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="blog-details-section pt-120 pb-120">
    <img alt="image" src="~/assets/images/bg/section-bg.png" class="img-fluid section-bg-top">
    <img alt="image" src="~/assets/images/bg/section-bg.png" class="img-fluid section-bg-bottom">
    <div class="container">
        <div class="row gy-5">
            <div class="col-lg-8">
                <div class="blog-details-single">
                    @if (Model.Comments.Count() > 0)
                    {
                        <div class="blog-comment">
                            <div class="blog-widget-title">
                                <h4>Comments (@Model.Comments.Count())</h4>
                                <span></span>
                            </div>
                            <ul class="comment-list mb-50">
                                @foreach (var comment in Model.Comments)
                                {
                                    <li>
                                        <div class="comment-box">
                                            <div class="comment-header d-flex justify-content-between align-items-center">
                                                <div class="author d-flex flex-wrap">
                                                    @*<img alt="image" src="~/assets/images/blog/comment1.png">*@
                                                    <h5><a href="#">@comment.AuthorFirstName @comment.AuthorLastName</a></h5><span class="commnt-date"> @comment.DatePlaced.ToLocalTime()</span>
                                                </div>
                                                @*<a href="#" class="commnt-reply"><i class="bi bi-reply"></i></a>*@
                                            </div>
                                            <div class="comment-body">
                                                <p class="para">@comment.Content</p>
                                            </div>
                                        </div>
                                    </li>
                                }
                            </ul>
                        </div>
                    }
                    <div class="comment-form">
                        <div class="blog-widget-title style2">
                            <h4>Leave A Comment</h4>
                            <span></span>
                        </div>
                        <form method="post" asp-controller="Auction" asp-action="Comment" asp-route-auctionId="@Model.Id">
                            <div class="row">
                                <div class="col-12">
                                    <div class="form-inner">
                                        <textarea asp-for="Comment" placeholder="Write Message :" rows="12"></textarea>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <button type="submit" class="eg-btn btn--primary btn--md form--btn">Submit Now</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function LoadBigImage(id) {
        let imageId = 'image+' + id;
        let bigImageElement = document.querySelector('#bigImage');
        let getImageSrc = document.getElementById(imageId).children[0].getAttribute('src');

        bigImageElement.setAttribute('src', getImageSrc);
    }
</script>