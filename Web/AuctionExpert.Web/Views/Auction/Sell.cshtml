@using AuctionExpert.Services.Data
@using AuctionExpert.Web.ViewModels.Auction
@using AuctionExpert.Web.ViewModels.SubCategory
@model AddAuctionViewModel

<div class="container pt-120 pb-120">
    <div class="row d-flex justify-content-center">
        <div class="col-xl-6 col-lg-8 col-md-10">
            <div class="form-wrapper wow fadeInUp" data-wow-duration="0.5s" data-wow-delay=".2s">
                <form class="w-100" method="post">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <div class="row">

                        <div class="col-md-12">
                            <div class="form-inner">
                                <label asp-for="Title">Title *</label>
                                <input asp-for="Title" class="form-control" placeholder="Title">
                                <span asp-validation-for="Title" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="form-inner">
                                <label asp-for="Description">Description *</label>
                                <input asp-for="Description" class="form-control" placeholder="Description">
                                <span asp-validation-for="Description" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="form-inner" onchange="getSubCategories()">
                                <label asp-for="CategoryId">Select Category *</label>
                                <select asp-for="CategoryId">
                                    <option selected="selected">--Please select a category--</option>
                                    @foreach (var category in Model.Categories)
                                    {
                                        <option value="@category.Id">@category.Name</option>
                                    }
                                </select>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="form-inner" onchange="getValue()">
                                <label asp-for="SubCateogoryId">Select Sub Category *</label>
                                <select asp-for="SubCateogoryId">
                                    <option></option>
                                </select>
                                <span asp-validation-for="SubCateogoryId"></span>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="form-inner">
                                <label asp-for="Condition">Condition *</label>
                                <select asp-for="Condition">
                                    <option>-Enter item condition--</option>
                                    <option value="1">Brand new</option>
                                    <option value="2">Used</option>
                                </select>
                                <span asp-validation-for="Condition"></span>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="form-inner">
                                <label asp-for="Type">Type of sale *</label>
                                <select asp-for="Type">
                                    <option>-Enter auction sale type--</option>
                                    <option value="1">Standart auction</option>
                                    <option value="2">Auction with fixed price</option>
                                </select>
                                <span asp-validation-for="Type"></span>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="form-inner">
                                <label asp-for="Duration">Duration *</label>
                                <input asp-for="Duration" class="form control" placeholder="Enter duration in days " />
                                <span asp-validation-for="Duration" class="text-danger"></span>
                            </div>
                        </div>

                    </div>
                    <button type="submit" asp-controller="Auction" asp-action="Sell" class="account-btn">Add Auction</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">

    function getSubCategories() {
        let selected = document.querySelectorAll("div .list")[0];
        let categoryId = Number.parseInt(selected.querySelector('.selected').getAttribute("data-value"));
        let ul = document.querySelectorAll("div .list")[1];
        ul.parentElement.parentElement.style.display = 'none';

        if (!Number.isInteger(categoryId) || categoryId == 0) {
            return;
        }

        fetch(`/api/SubCategory/?id=${categoryId}`, {
            method: 'get'
        })
            .then(response => response.json())
            .then(subCategories => {

                ul.parentElement.parentElement.style.display = 'block';

                for (let i = 0; i < subCategories.length; i++) {

                    let liElement = document.createElement("li");
                    liElement.classList.add("option");
                    liElement.setAttribute("data-value", subCategories[i].id)
                    liElement.textContent = subCategories[i].name
                    ul.appendChild(liElement)
                }
            })

        ul.innerHTML = '';
        document.querySelectorAll('.current')[1].textContent = '';
    }
</script>

<script>
    function getValue() {
        let selected = document.querySelectorAll("div .list")[1];
        let subCategoryId = Number.parseInt(selected.querySelector('.selected').getAttribute("data-value"));

        let optionElement = selected.parentElement.parentElement.getElementsByTagName('option')[0];
        optionElement.setAttribute('value', subCategoryId);
        optionElement.classList.add('selected');
    }
</script>
